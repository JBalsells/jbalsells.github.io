<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Física del Rescate — Nudos y Resistencia</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@600&family=Roboto:wght@300;400;500;700&display=swap">
  <link href="../vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="../css/font-awesome/css/all.min.css" rel="stylesheet">
  <link href="../css/main.css" rel="stylesheet">
  <style>
    .sim-wrapper *, .sim-wrapper *::before, .sim-wrapper *::after { box-sizing: border-box; margin: 0; padding: 0; }


    h1 {
      font-size: 1.4rem;
      color: #00BCD4;
      text-align: center;
      margin-bottom: 3px;
      letter-spacing: 0.4px;
      font-weight: 700;
    }

    .subtitle {
      font-size: 0.83rem;
      color: #FFC107;
      font-style: italic;
      text-align: center;
      margin-bottom: 10px;
    }

    .main-row {
      display: flex;
      gap: 12px;
      align-items: flex-start;
      margin-bottom: 8px;
      width: 100%;
      max-width: 1240px;
    }

    canvas {
      display: block;
      border-radius: 8px;
      border: 1px solid #2a2a3e;
      background: #0f0f1a;
      flex-shrink: 0;
      cursor: crosshair;
    }

    /* ── Side panel ──────────────────────────────────────────────── */
    .side-panel {
      flex: 1;
      min-width: 310px;
      max-width: 360px;
      background: #16213e;
      border: 1px solid #00BCD4;
      border-radius: 8px;
      padding: 14px 15px;
      display: flex;
      flex-direction: column;
      gap: 14px;
      font-size: 0.82rem;
    }

    .section-title {
      font-size: 0.77rem;
      font-weight: bold;
      color: #00BCD4;
      letter-spacing: 0.5px;
      text-transform: uppercase;
      margin-bottom: 7px;
      border-bottom: 1px solid #2a2a3e;
      padding-bottom: 3px;
    }

    /* Slider */
    .mbs-display {
      font-size: 1.15rem;
      font-weight: bold;
      color: #90A4AE;
      text-align: center;
      font-variant-numeric: tabular-nums;
      margin-bottom: 6px;
    }

    .slider-row {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .slider-end { font-size: 0.75rem; color: #546E7A; }

    input[type=range] {
      flex: 1;
      -webkit-appearance: none;
      height: 4px;
      border-radius: 2px;
      background: #2a2a3e;
      outline: none;
    }
    input[type=range]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 15px; height: 15px;
      border-radius: 50%;
      background: #90A4AE;
      cursor: pointer;
      border: 2px solid #ECEFF1;
    }
    input[type=range]::-moz-range-thumb {
      width: 15px; height: 15px;
      border-radius: 50%;
      background: #90A4AE;
      cursor: pointer;
      border: 2px solid #ECEFF1;
      box-sizing: border-box;
    }

    .slider-hint {
      text-align: center;
      font-size: 0.72rem;
      color: #37474F;
      margin-top: 4px;
    }

    /* Zone legend */
    .zone-row {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 5px;
      font-size: 0.80rem;
    }
    .zone-swatch {
      width: 10px; height: 10px;
      border-radius: 2px;
      flex-shrink: 0;
    }

    /* Stats */
    .stats-grid {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 6px;
    }
    .stat-card {
      background: #1a1a2e;
      border-radius: 6px;
      padding: 8px 4px;
      text-align: center;
      border: 1px solid #2a2a3e;
    }
    .stat-num {
      font-size: 1.4rem;
      font-weight: bold;
      font-variant-numeric: tabular-nums;
      line-height: 1;
    }
    .stat-lbl { font-size: 0.67rem; color: #546E7A; margin-top: 3px; }

    /* Knot detail */
    .knot-card {
      background: #1a1a2e;
      border-radius: 6px;
      padding: 10px 12px;
      border: 1px solid #2a2a3e;
      min-height: 94px;
    }
    .knot-name-head {
      font-size: 0.94rem;
      font-weight: bold;
      margin-bottom: 7px;
    }
    .detail-grid {
      display: grid;
      grid-template-columns: auto 1fr;
      gap: 3px 10px;
      font-size: 0.79rem;
    }
    .detail-grid .lbl { color: #546E7A; }
    .detail-grid .val { font-weight: bold; font-variant-numeric: tabular-nums; }
    .knot-desc-text {
      font-size: 0.74rem;
      color: #78909C;
      margin-top: 8px;
      line-height: 1.5;
      font-style: italic;
    }
    .hover-hint {
      font-size: 0.76rem;
      color: #37474F;
      text-align: center;
      font-style: italic;
      padding-top: 20px;
    }

    /* Info box */
    .info-box {
      background: #0d1f3a;
      border-radius: 6px;
      padding: 8px 10px;
      font-size: 0.73rem;
      color: #37474F;
      line-height: 1.65;
    }

    /* Footer */
    .footer {
      font-size: 0.72rem;
      color: #2a3a4a;
      text-align: center;
      font-style: italic;
      max-width: 1240px;
      margin-top: 2px;
    }

  
    /* ─── Simulation wrapper ──────────────────────────────────────────── */
    .sim-wrapper {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 24px 12px 36px;
      min-height: calc(100vh - 56px);
      background: #1b2a3b;
      color: #ECEFF1;
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      transition: background 0.3s ease;
    }
    [data-theme="dark"] .sim-wrapper {
      background: #0f0f1a;
    }
  </style>
  <script>(function(){var t=localStorage.getItem('theme');if(t)document.documentElement.setAttribute('data-theme',t);})();</script>
</head>
<body id="top">
  <!-- Scroll progress bar -->
  <div class="scroll-progress d-print-none" id="scrollProgress"></div>

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark sticky-nav d-print-none">
    <div class="container">
      <a class="navbar-brand" href="../index.html">Jorge A. Balsells Orellana</a>
      <div class="d-flex align-items-center ms-auto d-lg-none">
        <button class="btn btn-link nav-dark-toggle me-2" id="darkToggleMobile" aria-label="Toggle dark mode">
          <i class="fas fa-moon"></i>
        </button>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarMain" aria-controls="navbarMain" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
      </div>
      <div class="collapse navbar-collapse" id="navbarMain">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link" href="../index.html#about">About</a></li>
          <li class="nav-item"><a class="nav-link" href="../index.html#skills">Skills</a></li>
          <li class="nav-item"><a class="nav-link" href="../index.html#experience">Experience</a></li>
          <li class="nav-item"><a class="nav-link" href="../index.html#education">Education</a></li>
          <li class="nav-item"><a class="nav-link" href="../index.html#certs">Courses</a></li>
          <li class="nav-item"><a class="nav-link" href="../index.html#projects">Projects</a></li>
          <li class="nav-item"><a class="nav-link" href="../index.html#volunteer">Volunteering</a></li>
          <li class="nav-item"><a class="nav-link" href="../gallery.html">Gallery</a></li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle active" href="#" id="ropeSimsDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              Rope Simulations
            </a>
            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="ropeSimsDropdown">
              <li><a class="dropdown-item" href="anclaje_en_v.html">Anclaje en V</a></li>
              <li><a class="dropdown-item" href="camilla_en_tirolesa.html">Camilla en Tirolesa</a></li>
              <li><a class="dropdown-item" href="distribucion_multi_anclaje.html">Distribución Multi-Anclaje</a></li>
              <li><a class="dropdown-item" href="factor_de_caida.html">Factor de Caída</a></li>
              <li><a class="dropdown-item" href="fuerza_y_newton.html">¿Qué es un Newton?</a></li>
              <li><a class="dropdown-item" href="nudos_y_resistencia.html">Nudos y Resistencia</a></li>
              <li><a class="dropdown-item" href="tirolesa_fuerzas.html">Fuerzas en la Tirolesa</a></li>
              <li><a class="dropdown-item" href="vectores_fuerzas.html">Vectores y Suma de Fuerzas</a></li>
            </ul>
          </li>
          <li class="nav-item nav-contact-pill"><a class="nav-link" href="../index.html#contact"><i class="fas fa-envelope me-1"></i>Contact</a></li>
          <li class="nav-item d-none d-lg-block">
            <button class="btn btn-link nav-dark-toggle" id="darkToggleDesktop" aria-label="Toggle dark mode">
              <i class="fas fa-moon"></i>
            </button>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="sim-wrapper">



<h1>FÍSICA DEL RESCATE — Nudos y Resistencia de la Cuerda</h1>
<p class="subtitle">Un nudo siempre crea un punto débil — ¿cuánto se pierde?</p>

<div class="main-row">
  <canvas id="chart" width="870" height="660"></canvas>

  <div class="side-panel">

    <!-- MBS Slider -->
    <div>
      <div class="section-title">MBS de la Cuerda</div>
      <div class="mbs-display" id="mbsDisplay">30.0 kN</div>
      <div class="slider-row">
        <span class="slider-end">5 kN</span>
        <input type="range" id="mbsSlider" min="5" max="40" step="0.5" value="30">
        <span class="slider-end">40 kN</span>
      </div>
      <div class="slider-hint">Desliza para cambiar la resistencia de la cuerda</div>
    </div>

    <!-- Zone Legend -->
    <div>
      <div class="section-title">Zonas de Eficiencia</div>
      <div class="zone-row">
        <div class="zone-swatch" style="background:#4CAF50;"></div>
        <span><strong style="color:#4CAF50;">≥ 75 %</strong> — Aceptable en rescate</span>
      </div>
      <div class="zone-row">
        <div class="zone-swatch" style="background:#FFC107;"></div>
        <span><strong style="color:#FFC107;">60 – 75 %</strong> — Usar con precaución</span>
      </div>
      <div class="zone-row">
        <div class="zone-swatch" style="background:#F44336;"></div>
        <span><strong style="color:#F44336;">&lt; 60 %</strong> — Evitar en rescate</span>
      </div>
      <div style="margin-top:5px;font-size:0.73rem;color:#37474F;">
        Mínimo recomendado NFPA / UIAA: 75 %
      </div>
    </div>

    <!-- Stats -->
    <div>
      <div class="section-title">Distribución de Nudos</div>
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-num" style="color:#4CAF50;" id="cntGreen">5</div>
          <div class="stat-lbl">Aceptables</div>
        </div>
        <div class="stat-card">
          <div class="stat-num" style="color:#FFC107;" id="cntYellow">12</div>
          <div class="stat-lbl">Precaución</div>
        </div>
        <div class="stat-card">
          <div class="stat-num" style="color:#F44336;" id="cntRed">2</div>
          <div class="stat-lbl">Evitar</div>
        </div>
      </div>
    </div>

    <!-- Knot detail -->
    <div>
      <div class="section-title">Detalle del Nudo</div>
      <div class="knot-card" id="knotCard">
        <div class="hover-hint">Pasa el cursor sobre<br>un nudo para ver su detalle</div>
      </div>
    </div>

    <!-- Legend for lines -->
    <div class="info-box">
      <strong style="color:#00BCD4;">MBS</strong> = Resistencia Mínima de Rotura<br>
      <strong style="color:#FF6F00;">— · —</strong>&nbsp; Carga mínima NFPA (13.5 kN)<br>
      <strong style="color:#FFC107;">- - -</strong>&nbsp;&nbsp; Eficiencia mínima NFPA/UIAA (75 %)<br>
      Fuente: NFPA 1983 · UIAA 101
    </div>

  </div>
</div>

<p class="footer">
  Nudo en ocho: estándar NFPA/UIAA &nbsp;│&nbsp;
  Prusik / Klemheist / Bachmann: nudos de fricción &nbsp;│&nbsp;
  Nudo plano: PELIGROSO, nunca como anclaje &nbsp;│&nbsp;
  MBS = Resistencia Mínima de Rotura
</p>

<script>
// ── Data ──────────────────────────────────────────────────────────────────
const KNOTS = [
  { name: 'Sin nudo',              eff: 100, color: '#4CAF50', desc: 'Referencia: resistencia total de la cuerda.' },
  { name: 'Nudo en ocho',          eff: 80,  color: '#00BCD4', desc: 'El más usado en rescate. Fácil de verificar. Estándar NFPA/UIAA.' },
  { name: 'Ocho en seno',          eff: 78,  color: '#26C6DA', desc: 'Bucle en el seno de la cuerda. No corta la cuerda.' },
  { name: 'Ocho doble (orejas)',   eff: 77,  color: '#00ACC1', desc: 'Crea dos gazas simultáneas. Ideal para anclajes en Y.' },
  { name: 'As de guía (Bowline)',  eff: 75,  color: '#2196F3', desc: 'Anclaje rápido en extremo. No usar bajo carga dinámica sola.' },
  { name: 'As de guía doble',      eff: 72,  color: '#42A5F5', desc: 'Bowline con doble vuelta. Más seguro ante cargas variables.' },
  { name: 'Nudo dinámico (HMS)',   eff: 70,  color: '#E91E63', desc: 'Freno y rappel reversible. Requiere mosquetón de pera (HMS).' },
  { name: 'Pescador doble',        eff: 70,  color: '#9C27B0', desc: 'Unión de dos cuerdas. Muy seguro, compacto y fiable.' },
  { name: 'Zeppelin (bend)',       eff: 68,  color: '#7E57C2', desc: 'Unión segura. Notable: fácil de deshacer incluso bajo carga.' },
  { name: 'Mariposa alpina',       eff: 68,  color: '#FF9800', desc: 'Nudo de línea media. Cargable en tres direcciones.' },
  { name: 'Pescador simple',       eff: 65,  color: '#CE93D8', desc: 'Versión simple del pescador. Menos segura que el doble.' },
  { name: 'Ballestrinque',         eff: 65,  color: '#66BB6A', desc: 'Anclaje rápido en postes y mosquetones. Puede deslizar.' },
  { name: 'Prusik',                eff: 65,  color: '#FF7043', desc: 'Nudo de fricción para ascenso y bloqueo. Libera bajo carga.' },
  { name: 'Klemheist',             eff: 63,  color: '#FFA726', desc: 'Fricción con cinta o cordino. Unidireccional.' },
  { name: 'Bachmann',              eff: 62,  color: '#78909C', desc: 'Fricción con mosquetón añadido. Permite ajuste manual.' },
  { name: 'Garda (Ratchet)',       eff: 60,  color: '#A1887F', desc: 'Trinquete de progreso. Solo carga en un sentido.' },
  { name: 'Nudo simple',           eff: 60,  color: '#F44336', desc: 'El más débil. Solo como tope de emergencia, nunca anclaje.' },
  { name: 'Nudo de agua',          eff: 55,  color: '#AB47BC', desc: 'Para unir cintas y slings. Revisar siempre antes de usar.' },
  { name: 'Nudo plano',            eff: 45,  color: '#B71C1C', desc: 'PELIGROSO: se desliza y vira bajo carga. NO usar en rescate.' },
];

const NFPA_WL = 13.5;   // kN — carga mínima de trabajo NFPA
const EFF_MIN = 75;      // % — eficiencia mínima recomendada

// ── Canvas layout ─────────────────────────────────────────────────────────
const canvas = document.getElementById('chart');
const ctx    = canvas.getContext('2d');
const CW = canvas.width;    // 870
const CH = canvas.height;   // 660
const L   = 188;             // margen izquierdo (nombres de nudos)
const T   = 62;              // margen superior (etiquetas de zona + título)
const R_M = 148;             // margen derecho (etiquetas kN)
const B_M = 46;              // margen inferior
const W_PLOT = CW - L - R_M;        // 534 px
const H_PLOT = CH - T - B_M;        // 552 px
const N      = KNOTS.length;         // 19
const ROW_H  = H_PLOT / N;           // ≈ 29.05 px
const BAR_H  = Math.round(ROW_H * 0.62); // ≈ 18 px
const EFF_MAX = 115;                  // máximo del eje X (%)

const xp = e => L + e * W_PLOT / EFF_MAX;
const yc = i => T + (i + 0.5) * ROW_H;

// ── DOM refs ──────────────────────────────────────────────────────────────
const mbsSlider  = document.getElementById('mbsSlider');
const mbsDisplay = document.getElementById('mbsDisplay');
const knotCard   = document.getElementById('knotCard');

let hoveredKnot = null;

// ── Draw ──────────────────────────────────────────────────────────────────
function draw() {
  const mbs = parseFloat(mbsSlider.value);
  ctx.clearRect(0, 0, CW, CH);

  // ── Fondos de zona ──────────────────────────────────────────────────
  ctx.save();
  ctx.globalAlpha = 0.07;
  ctx.fillStyle = '#F44336';
  ctx.fillRect(xp(0), T, xp(60) - xp(0), H_PLOT);
  ctx.fillStyle = '#FFC107';
  ctx.fillRect(xp(60), T, xp(EFF_MIN) - xp(60), H_PLOT);
  ctx.fillStyle = '#4CAF50';
  ctx.fillRect(xp(EFF_MIN), T, xp(EFF_MAX) - xp(EFF_MIN), H_PLOT);
  ctx.restore();

  // ── Etiquetas de zona (arriba del gráfico) ──────────────────────────
  ctx.font = '9.5px Segoe UI';
  ctx.textAlign = 'center';
  ctx.fillStyle = '#EF5350';
  ctx.fillText('Evitar en rescate', xp(30), T - 10);
  ctx.fillStyle = '#FFB300';
  ctx.fillText('Con precaución', xp(67.5), T - 10);
  ctx.fillStyle = '#66BB6A';
  ctx.fillText('Aceptable en rescate', xp(87.5), T - 10);

  // ── Líneas de cuadrícula suave ───────────────────────────────────────
  ctx.save();
  ctx.strokeStyle = 'rgba(255,255,255,0.07)';
  ctx.lineWidth = 1;
  [25, 50].forEach(e => {
    ctx.beginPath();
    ctx.moveTo(xp(e), T);
    ctx.lineTo(xp(e), T + H_PLOT);
    ctx.stroke();
  });
  ctx.restore();

  // ── Línea de referencia 60 % ────────────────────────────────────────
  ctx.save();
  ctx.strokeStyle = 'rgba(244,67,54,0.60)';
  ctx.lineWidth = 1.2;
  ctx.setLineDash([3, 3]);
  ctx.beginPath();
  ctx.moveTo(xp(60), T); ctx.lineTo(xp(60), T + H_PLOT);
  ctx.stroke();
  ctx.restore();

  // ── Línea de referencia 75 % ────────────────────────────────────────
  ctx.save();
  ctx.strokeStyle = 'rgba(255,193,7,0.85)';
  ctx.lineWidth = 1.8;
  ctx.setLineDash([5, 4]);
  ctx.beginPath();
  ctx.moveTo(xp(EFF_MIN), T); ctx.lineTo(xp(EFF_MIN), T + H_PLOT);
  ctx.stroke();
  ctx.restore();

  // ── Línea NFPA (carga mínima de trabajo) ────────────────────────────
  const nfpaEff = (NFPA_WL / mbs) * 100;
  if (nfpaEff > 0 && nfpaEff < EFF_MAX) {
    ctx.save();
    ctx.strokeStyle = 'rgba(255,111,0,0.60)';
    ctx.lineWidth = 1.6;
    ctx.setLineDash([4, 2, 1, 2]);
    ctx.beginPath();
    ctx.moveTo(xp(nfpaEff), T); ctx.lineTo(xp(nfpaEff), T + H_PLOT);
    ctx.stroke();
    ctx.restore();
    ctx.font = '8.5px Segoe UI';
    ctx.textAlign = 'left';
    ctx.fillStyle = '#FF6F00';
    ctx.fillText(`NFPA ${NFPA_WL} kN`, xp(nfpaEff) + 3, T + 13);
  }

  // ── Barras ───────────────────────────────────────────────────────────
  for (let i = 0; i < N; i++) {
    const k      = KNOTS[i];
    const eff    = k.eff;
    const mbsNudo = mbs * eff / 100;
    const y0     = yc(i);
    const isHov  = (hoveredKnot === i);
    const barW   = eff * W_PLOT / EFF_MAX;
    const barY   = Math.round(y0 - BAR_H / 2);

    // Resalte de fila al pasar el cursor
    if (isHov) {
      ctx.save();
      ctx.globalAlpha = 0.08;
      ctx.fillStyle = '#FFFFFF';
      ctx.fillRect(L, T + i * ROW_H, W_PLOT, ROW_H);
      ctx.restore();
    }

    // Relleno de barra
    ctx.save();
    ctx.globalAlpha = isHov ? 1.0 : (eff >= EFF_MIN ? 0.88 : eff >= 60 ? 0.78 : 0.72);
    ctx.fillStyle = k.color;
    ctx.fillRect(L, barY, barW, BAR_H);
    ctx.restore();

    // Borde para nudos peligrosos o resaltados
    if (eff < 60 || isHov) {
      ctx.save();
      ctx.strokeStyle = isHov ? 'rgba(255,255,255,0.65)' : '#F44336';
      ctx.lineWidth   = (eff < 60 && !isHov) ? 2.2 : 1.4;
      ctx.strokeRect(L, barY, barW, BAR_H);
      ctx.restore();
    }

    // Texto de descripción dentro de la barra (si hay espacio)
    if (barW > 40 && eff >= 50) {
      ctx.save();
      ctx.beginPath();
      ctx.rect(L + 2, barY, barW - 4, BAR_H);
      ctx.clip();
      ctx.font = `${Math.min(8, BAR_H * 0.42)}px Segoe UI`;
      ctx.textAlign = 'center';
      ctx.fillStyle = 'rgba(255,255,255,0.70)';
      ctx.fillText(k.desc, L + barW / 2, y0 + 3.5);
      ctx.restore();
    }

    // Etiqueta ⚠ NO RESCATE para nudos con eficiencia < 50 %
    if (eff < 50) {
      ctx.save();
      ctx.beginPath();
      ctx.rect(L, barY, barW, BAR_H);
      ctx.clip();
      ctx.font = 'bold 7.5px Segoe UI';
      ctx.textAlign = 'center';
      ctx.fillStyle = 'rgba(255,255,255,0.92)';
      ctx.fillText('⚠ NO RESCATE', L + barW / 2, y0 + 3.5);
      ctx.restore();
    }

    // Etiqueta % → kN a la derecha de la barra
    ctx.save();
    ctx.font = 'bold 9px Segoe UI';
    ctx.textAlign = 'left';
    ctx.fillStyle = isHov ? '#ECEFF1' : k.color;
    ctx.fillText(`${eff}%  →  ${mbsNudo.toFixed(1)} kN`, L + barW + 6, y0 + 4);
    ctx.restore();

    // Nombre del nudo a la izquierda
    ctx.save();
    ctx.textAlign = 'right';
    ctx.font = eff < 60 ? 'bold 9px Segoe UI' : '9px Segoe UI';
    ctx.fillStyle = isHov ? '#ECEFF1' : (eff < 60 ? '#EF5350' : '#90A4AE');
    ctx.fillText(k.name, L - 6, y0 + 4);
    ctx.restore();
  }

  // ── Etiquetas del eje X ──────────────────────────────────────────────
  ctx.save();
  ctx.font = '9px Segoe UI';
  ctx.textAlign = 'center';
  ctx.fillStyle = '#546E7A';
  [[0,'0 %'],[25,'25 %'],[50,'50 %'],[60,'60 %'],[EFF_MIN,'75 %'],[100,'100 %']].forEach(([e, lbl]) => {
    ctx.fillText(lbl, xp(e), T + H_PLOT + 16);
  });
  ctx.restore();

  // ── Título del eje X ────────────────────────────────────────────────
  ctx.save();
  ctx.font = '10.5px Segoe UI';
  ctx.textAlign = 'center';
  ctx.fillStyle = '#78909C';
  ctx.fillText('Eficiencia del nudo (% del MBS de la cuerda)', L + W_PLOT / 2, T + H_PLOT + 32);
  ctx.restore();

  // ── Título dentro del canvas ─────────────────────────────────────────
  ctx.save();
  ctx.font = 'bold 12.5px Segoe UI';
  ctx.textAlign = 'left';
  ctx.fillStyle = '#00BCD4';
  ctx.fillText(`Nudos y Resistencia  —  MBS cuerda = ${mbs.toFixed(1)} kN`, L, T - 26);
  ctx.restore();
}

// ── Panel de detalle del nudo ─────────────────────────────────────────────
function updateKnotCard(i) {
  if (i === null) {
    knotCard.innerHTML = '<div class="hover-hint">Pasa el cursor sobre<br>un nudo para ver su detalle</div>';
    return;
  }
  const mbs     = parseFloat(mbsSlider.value);
  const k       = KNOTS[i];
  const mbsNudo = mbs * k.eff / 100;
  const perdida = mbs - mbsNudo;

  let zona, zonaColor;
  if (k.eff >= EFF_MIN)  { zona = 'Aceptable en rescate';  zonaColor = '#4CAF50'; }
  else if (k.eff >= 60)  { zona = 'Usar con precaución';   zonaColor = '#FFC107'; }
  else                   { zona = 'Evitar en rescate';      zonaColor = '#F44336'; }

  knotCard.innerHTML = `
    <div class="knot-name-head" style="color:${k.color};">${k.name}</div>
    <div class="detail-grid">
      <span class="lbl">Eficiencia:</span>
      <span class="val" style="color:${k.color};">${k.eff} %</span>
      <span class="lbl">MBS con nudo:</span>
      <span class="val">${mbsNudo.toFixed(2)} kN</span>
      <span class="lbl">Pérdida:</span>
      <span class="val" style="color:#EF5350;">−${perdida.toFixed(2)} kN</span>
      <span class="lbl">Zona:</span>
      <span class="val" style="color:${zonaColor};">${zona}</span>
    </div>
    <div class="knot-desc-text">${k.desc}</div>
  `;
}

// ── Eventos ───────────────────────────────────────────────────────────────
mbsSlider.addEventListener('input', () => {
  mbsDisplay.textContent = `${parseFloat(mbsSlider.value).toFixed(1)} kN`;
  updateKnotCard(hoveredKnot);
  draw();
});

canvas.addEventListener('mousemove', e => {
  const rect   = canvas.getBoundingClientRect();
  const scaleX = CW / rect.width;
  const scaleY = CH / rect.height;
  const cx = (e.clientX - rect.left) * scaleX;
  const cy = (e.clientY - rect.top)  * scaleY;

  let newHov = null;
  if (cx >= L && cx <= L + W_PLOT && cy >= T && cy <= T + H_PLOT) {
    const idx = Math.floor((cy - T) / ROW_H);
    if (idx >= 0 && idx < N) newHov = idx;
  }

  if (newHov !== hoveredKnot) {
    hoveredKnot = newHov;
    updateKnotCard(hoveredKnot);
    draw();
  }
});

canvas.addEventListener('mouseleave', () => {
  if (hoveredKnot !== null) {
    hoveredKnot = null;
    updateKnotCard(null);
    draw();
  }
});

// ── Inicializar ───────────────────────────────────────────────────────────
draw();
</script>


  </div><!-- /.sim-wrapper -->

  <footer class="site-footer d-print-none">
    <div class="container text-center">
      <p>&copy; <span id="footer-year"></span> Jorge A. Balsells Orellana. All rights reserved.</p>
    </div>
  </footer>

  <button class="back-to-top d-print-none" id="backToTop" aria-label="Back to top">
    <i class="fas fa-chevron-up"></i>
  </button>

  <script src="../vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="../scripts/aos.js"></script>
  <script src="../scripts/main.js"></script>

</body>
</html>
